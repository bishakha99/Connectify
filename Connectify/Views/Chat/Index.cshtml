@model Connectify.ViewModels.ChatViewModel
@{
    ViewData["Title"] = "Chat";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid py-3">
    <div class="chat-container">

        <!-- User List Sidebar -->
        <div class="user-sidebar">
            <div class="sidebar-header">
                Chats
            </div>
            <ul id="user-list" class="list-unstyled user-list mb-0">
                @foreach (var user in Model.AllUsers)
                {
                    <li class="user-item" data-userid="@user.Id" data-username="@user.Username">
                        <div class="avatar">
                            @user.Username.ToUpper()[0] <!-- Use first initial for avatar -->
                        </div>
                        <div class="username">@user.Username</div>
                        <div id="status-@user.Id" class="status-indicator @(user.IsActive == true ? "status-online" : "status-offline")"></div>
                    </li>
                }
            </ul>
        </div>

        <!-- Chat Window -->
        <div class="chat-window">
            <!-- Welcome/Empty State -->
            <div id="welcome-message" class="d-flex flex-column justify-content-center align-items-center h-100 text-center">
                <i class="bi bi-chat-dots-fill" style="font-size: 5rem; color: #ccc;"></i>
                <h3 class="mt-3">Welcome, @Model.CurrentUser.Username!</h3>
                <p class="text-muted">Select a chat to start messaging.</p>
            </div>

            <!-- Main Chat Area (Initially Hidden) -->
            <div id="main-chat-area" class="d-none h-100 flex-column">
                <div class="chat-header" id="chat-with-header">
                    <!-- Partner info will be injected here by JS -->
                </div>
                <div class="chat-messages" id="chat-messages-container">
                    <!-- Messages will be loaded here -->
                </div>
                <div class="chat-footer">
                    <div class="input-group">
                        <input type="text" id="message-input" class="form-control" placeholder="Type a message..." disabled>
                        <label for="image-upload" class="btn btn-outline-secondary m-0">
                            <i class="bi bi-image"></i>
                        </label>
                        <input type="file" id="image-upload" accept="image/*" style="display:none;">
                        <button id="send-button" class="btn btn-primary" disabled><i class="bi bi-send-fill"></i></button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Hidden fields -->
<input type="hidden" id="receiver-id" />
<input type="hidden" id="current-userid" value="@Model.CurrentUser.Id" />
@Html.AntiForgeryToken()

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="~/js/chat.js"></script>
}